<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Test Widget</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="/common/ui/melange.css" media="screen">

    <script type="text/javascript" src="/common/core/mootools.js"></script>
    <script type="text/javascript" src="/common/core/mootools-more.js"></script>

    <script type="text/javascript" src="/common/core/core.js"></script>

    <script type="text/javascript" src="/common/ui/scroll/scroll.js" /></script>
</head>

<body>
    <div class="widget" style="width: 180px;">
        <div class="background">
            <div id="foo" class="scroll" style="height: 220px;">
                <div id="identica">
                </div>
    
                <script type="text/javascript">
                var script = null;
                function set_data(data) {
                    for (var c = 0; c < data.length && c < 10; c++) {
                        var content = data[c]['text'];
                        content = content.replace(/http:\/\/([^ ]+)/g, "<a class=\"thin\" href=\"http://$1\" target=\"_laconica\">http://$1</a>");
                        content = content.replace(/@([\w*]+)/g, '@<a class=\"thin\" href="http://identi.ca/$1" target=\"_laconica\">$1</a>');
                        content = content.replace(/#([\w*]+)/g, '#<a class=\"thin\" href="http://identi.ca/tag/$1" target="_laconica">$1</a>');
                        content = content.replace(/!([\w*]+)/g, '!<a class=\"thin\" href="http://identi.ca/group/$1" target="_laconica">$1</a>');
    
                        box = document.createElement('div')
                        box.innerHTML = '<span style="font-size: .9em;">' + content + '</span><br /><span style="font-size: .7em; color: #999;">- ' + data[c]['user']['screen_name'] + ' at ' + data[c]['created_at'].split(/\+/)[0] + '</span>';
    
                        if (c != 0) {
                            box.style.paddingTop = "10px";
                        }
    
                        $('identica').appendChild(box);
                    }
                }
    
                function update() {
                    var head = document.getElementsByTagName("head")[0];
                    if(script != null) head.removeChild(script);
                    script = document.createElement('script');
                    script.id = 'data';
                    script.type = 'text/javascript';
                    script.src = "https://identi.ca/api/statusnet/groups/timeline/cream.json?callback=set_data";
                    document.getElementById('identica').innerHTML = "";
                    head.appendChild(script);
                }
                update();
                </script>
            </div>
        </div>
    </div>
</body>
</html>
