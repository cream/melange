<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

    <head>
        <title>Audiocontrol Widget</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <link rel="stylesheet" type="text/css" href="/common/ui/melange.css" media="screen" />

        <script type="text/javascript" src="/common/core/mootools.js" />
        <script type="text/javascript" src="/common/core/mootools-more.js" />
        <script type="text/javascript" src="/common/ui/scroll/mooscroll/mooscroll.js" />
        <script type="text/javascript" src="/common/core/events.js" />
        <script type="text/javascript" src="/common/core/cream.js" />
        <script type="text/javascript" src="/common/ui/chooser/chooser.js" />
        <script type="text/javascript" src="/common/ui/scroll/scroll.js" />
        <script type="text/javascript" src="/common/ui/dialog/dialog.js" />


        <script type="text/javascript">                
            function main() {

                function update_data() {
                    widget.api.audiocontrol.song_changed(function(changed) {
                        if (changed) {

                            widget.api.audiocontrol.get_track_data(function(data) {
                                $('title').innerHTML = data['title'];
                                $('artist').innerHTML = data['artist'];
                                $('album').innerHTML = data['album'];

                                widget.api.audiocontrol.get_cover_art(data['artist'], data['title'], data['album'], function(path) {
                                    $('cover-art').innerHTML = '<img src="' + path + '" / >';
                                });

                                widget.api.audiocontrol.get_lyrics(data['artist'], data['title'], function(lyrics) {
                                    $('lyrics-content').innerHTML = lyrics;
                                });

                            });

                            update_rating();
                        }

                    });

                    widget.api.audiocontrol.is_playing(function(playing) {
                        if (playing){
                            $('play').innerHTML = '<img src="images/pause.png"/ >';
                        } else {
                            $('play').innerHTML = '<img src="images/play.png"/ >';
                        }
                    });

                }

                function update_rating() {
                    var buttons = ['1', '2', '3', '4', '5']
                    widget.api.audiocontrol.get_rating(function(rating) {
                        for(i = 0; i<5; i++) {
                            if (i < rating) {
                                $(buttons[i]).innerHTML = '<img src="images/star_yellow.png"/ >';
                            } else {
                                $(buttons[i]).innerHTML = '<img src="images/star_grey.png"/ >';
                            }
                        }

                    });

                }
                
                $('play').onclick = function() {
                    widget.api.audiocontrol.is_playing(function(playing) {
                        if (playing) {
                            widget.api.audiocontrol.pause();
                            $('play').innerHTML = '<img src="images/play.png"/ >';
                        } else {
                            widget.api.audiocontrol.play();
                            $('play').innerHTML = '<img src="images/pause.png"/ >';
                        }
                    });
                } 
                
                $('previous').onclick = function() {
                    widget.api.audiocontrol.previous_track();
                    update_data();
                    update_rating();
                }

                $('next').onclick = function() {
                    widget.api.audiocontrol.next_track();
                    update_data();
                    update_rating();
                }
                $('1').onclick = function() {
                    widget.api.audiocontrol.set_rating(1);
                    update_rating();
                }
                $('2').onclick = function() {
                    widget.api.audiocontrol.set_rating(2);
                    update_rating();
                }
                $('3').onclick = function() {
                    widget.api.audiocontrol.set_rating(3);
                    update_rating();
                }
                $('4').onclick = function() {
                    widget.api.audiocontrol.set_rating(4);
                    update_rating();
                }
                $('5').onclick = function() {
                    widget.api.audiocontrol.set_rating(5);
                    update_rating();
                }

                update_data.periodical(2000);

            };

        </script>


    </head>

    <body>
        <div class="widget" style="width: 220px;">
            <div class="background">
                <div class="chooser" id="mode">
                    <div class="option" id="control">
                        control
                    </div>
                    <div class="option" id="lyrics">
                        lyrics
                    </div>
                </div>
                <div class="chooser-tabs section" id="mode-tabs">
                    <div id="control-tab" class="tab">
                        <div id="cover-art" style="text-align: center;"></div>
                        <table border="0" align="center">
                            <tr>
                                <td><div class="button" id="1" style="background: none; padding: 0;"><img src="images/star_yellow.png" /></div></td>
                                <td><div class="button" id="2" style="background: none; padding: 0;"><img src="images/star_yellow.png" /></div></td>
                                <td><div class="button" id="3" style="background: none; padding: 0;"><img src="images/star_yellow.png" /></div></td>
                                <td><div class="button" id="4" style="background: none; padding: 0;"><img src="images/star_yellow.png" /></div></td>
                                <td><div class="button" id="5" style="background: none; padding: 0;"><img src="images/star_yellow.png" /></div></td>
                            </tr>
                        </table>
                        <div id="title" style="text-align: center;">None</div>
                        <div id="artist" style="text-align: center;">None</div>
                        <div id="album" style="text-align: center;">None</div>
                        <table border="0"> 
                            <tr>
                                <td><div class="button" id="previous" style="background: none;"><img src="images/back.png" /></div></td>
                                <td><div class="button" id="play" style="background: none;"><img src="images/play.png" /></div></td>
                                <td><div class="button" id="next" style="background: none;"><img src="images/forward.png" /></div></td>
                            </tr>
                        </table>
                    </div>
                    <div id="lyrics-tab" class="tab">
                        <div class="scroll" style="height: 265px;">
                            <div id="lyrics-content">
                                Here comes the lyrics
                            </div>
                        </div>
                    </div>
    
                </div>
            </div>
        </div>

    </body>
</html>
